@model TechBazaar.Core.ModelViews.ProductDetailsModelView

@{
    ViewData["Title"] = "Product Details";
}

<h2>@Model.Name</h2>

<div>
    <h4>Product Details</h4>
    <hr />
    <dl class="dl-horizontal">
        <dt>Description</dt>
        <dd>@Model.Description</dd>
        <dt>Price</dt>
        <dd>@Model.Price</dd>
        <dt>Category</dt>
        <dd>@Model.CategoryName</dd>
        <dt>Brand</dt>
        <dd>@Model.BrandName</dd>
        <dt>Quantity</dt>
        <dd>
            <p>
                <strong>Availability:</strong>
                @if (Model.Quantity > 0)
                {
                    <span class="badge bg-success">In Stock (@Model.Quantity)</span>
                }
                else
                {
                    <span class="badge bg-danger">Out of Stock</span>
                }

            </p>
        </dd>
        <dt>Images</dt>
        <dd>
            @if (Model.Images != null && Model.Images.Any())
            {
                foreach (var image in Model.Images)
                {
                    <img src="@image" alt="Product Image" style="width: 100px; height: auto;" />
                }
            }
            else
            {
                <p>No images available</p>
            }
        </dd>
    </dl>
</div>

<div>
    <form asp-controller="WishList" asp-action="AddToWishList" method="post">
    <a asp-controller="Home" asp-action="Index" class="btn btn-primary">Back To List</a> |
        <input type="hidden" name="productId" value="@Model.Id" />
        <button type="submit" class="btn btn-primary">Add to Wish List</button> |
    
    @if (Model.Quantity > 0)
    {
        <button type="button" onclick="add(@Model.Id)" class="btn btn-primary">Add to cart</button>
    }
    else
    {
        <span style="border: 1px solid;padding: 5px 8px;color: red;border-radius: 5px;">Out of stock</span>
    }
    </form>
    @section Scripts {
        <script>
            async function add(productId) {
                 var username = document.getElementById("username");
            if(username == null){
                window.location.href = "/Account/Login";
            }
            $.ajax({
                url: '/cart/addtocart',
                type: 'POST',
                data: {
                    productId: `${productId}`,
                    quantity: 1
                },
                success: function() {
                    location.reload();
                },
                error: function(xhr, status, error) {
                 alert("not enough stock");
                }
            });
            }
        </script>
    }
    
</div>

